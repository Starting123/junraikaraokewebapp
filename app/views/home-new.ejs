<%
  // Set up layout variables
  var layoutData = {
    title: title,
    currentPage: currentPage,
    pageCSS: pageCSS,
    user: user,
    csrfToken: csrfToken,
    roomStats: roomStats,
    featuredRooms: featuredRooms
  };
%>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <!-- CSRF Token Meta -->
    <meta name="csrf-token" content="<%= csrfToken %>">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Global Styles -->
    <link rel="stylesheet" href="/stylesheets/global.css">
    
    <!-- Page-specific Styles -->
    <% if (typeof pageCSS !== 'undefined') { %>
        <% if (Array.isArray(pageCSS)) { %>
            <% pageCSS.forEach(function(css) { %>
                <link rel="stylesheet" href="/stylesheets/<%= css %>.css">
            <% }); %>
        <% } else { %>
            <link rel="stylesheet" href="/stylesheets/<%= pageCSS %>.css">
        <% } %>
    <% } %>
</head>
<body data-current-page="<%= currentPage %>">
    <!-- Include Navigation -->
    <%- include('partials/navbar') %>
    
    <!-- Main Content -->
    <main class="main-content">
        <%- include('pages/home') %>
    </main>
    
    <!-- Include Footer -->
    <%- include('partials/footer') %>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Expose Server Data to Client -->
    <script>
        window.serverData = {
            user: <%- JSON.stringify(user) %>,
            isAuthenticated: '<%= user ? "true" : "false" %>',
            csrfToken: '<%= csrfToken %>',
            currentPage: '<%= currentPage %>',
            environment: '<%= typeof process !== "undefined" && process.env.NODE_ENV ? process.env.NODE_ENV : "production" %>',
            roomStats: <%- JSON.stringify(roomStats) %>,
            featuredRooms: <%- JSON.stringify(featuredRooms) %>
        };
    </script>
    
    <!-- Core JavaScript Modules (Load Order Important) -->
    <script src="/js/core/dom.js"></script>
    <script src="/js/core/events.js"></script>
    <script src="/js/core/api.js"></script>
    
    <!-- Feature Modules -->
    <script src="/js/modules/auth.js"></script>
    <script src="/js/modules/booking.js"></script>
    <script src="/js/modules/payment.js"></script>
    <script src="/js/modules/adminDashboard.js"></script>
    
    <!-- Main Application -->
    <script src="/js/main.js"></script>
</body>
</html>