<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Junrai Karaoke - ระบบจองห้องคาราโอเกะออนไลน์</title>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/index.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <div class="navbar-content">
        <a href="/" class="navbar-brand">
          <i class="fas fa-microphone-alt"></i>
          Junrai Karaoke
        </a>
        
        <div class="navbar-main">
          <ul class="navbar-nav">
            <li><a href="/" class="nav-link active">หน้าหลัก</a></li>
            <li><a href="/rooms" class="nav-link">ห้องคาราโอเกะ</a></li>
            <li><a href="/bookings" class="nav-link" id="bookingsLink" style="display: none;">การจอง</a></li>
            <li><a href="/contact" class="nav-link">ติดต่อเรา</a></li>
            <li><a href="/auth" class="nav-link" id="authLink">เข้าสู่ระบบ</a></li>
            <li><button class="btn btn-outline" onclick="logout()" id="logoutBtn" style="display: none;">ออกจากระบบ</button></li>
          </ul>
          
          <!-- Store Hours Info -->
          <div class="store-hours-info" id="storeHoursInfo">
            <div class="hours-display">
              <i class="fas fa-clock"></i>
              <div class="hours-text">
                <span class="hours-time">11.00 - 21.00</span>
                <span class="hours-duration">10 ชม</span>
              </div>
            </div>
            <div class="days-display">
              <span class="open-days">เปิด: อังคาร - อาทิตย์</span>
              <span class="closed-day">(หยุด) จันทร์</span>
            </div>
            <div class="store-status" id="storeStatus">
              <span class="status-text" id="statusText">กำลังตรวจสอบ...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">
          <i class="fas fa-microphone-alt"></i>
          ยินดีต้อนรับสู่ Junrai Karaoke
        </h1>
        <p class="hero-subtitle">จองห้องคาราโอเกะออนไลน์ ง่าย สะดวก พร้อมบริการครบครัน</p>
        <div class="hero-actions">
          <a href="/rooms" class="btn btn-primary btn-lg">
            <i class="fas fa-door-open"></i>
            ดูห้องคาราโอเกะ
          </a>
          <a href="/bookings" class="btn btn-outline btn-lg" id="heroBookingBtn" style="display: none;">
            <i class="fas fa-calendar-plus"></i>
            จองห้องตอนนี้
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features-section">
    <div class="container">
      <div class="section-header">
        <h2>บริการของเรา</h2>
        <p>เพลิดเพลินกับการร้องเพลงในบรรยากาศที่ดีที่สุด</p>
      </div>
      
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-music"></i>
          </div>
          <h3>เพลงครบทุกแนว</h3>
          <p>เพลงไทย สากล เกาหลี ญี่ปุ่น และอื่นๆ อีกมากมาย</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-utensils"></i>
          </div>
          <h3>อาหารและเครื่องดื่ม</h3>
          <p>บริการอาหารและเครื่องดื่มคุณภาพดี ส่งตรงถึงห้อง</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <h3>จองออนไลน์</h3>
          <p>จองห้องได้ตลอด 24 ชั่วโมง ผ่านระบบออนไลน์</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-star"></i>
          </div>
          <h3>ห้องหลากหลาย</h3>
          <p>ห้องธรรมดา VIP และห้องกลุ่มใหญ่ ตามความต้องการ</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Popular Rooms Section -->
  <section class="rooms-section">
    <div class="container">
      <div class="section-header">
        <h2>ห้องแนะนำ</h2>
        <p>ห้องคาราโอเกะยอดนิยมของเรา</p>
      </div>
      
      <div class="rooms-grid" id="popularRooms">
        <div class="loading">
          <div class="spinner"></div>
          <p>กำลังโหลดข้อมูลห้อง...</p>
        </div>
      </div>
      
      <div class="text-center mt-4">
        <a href="/rooms" class="btn btn-primary btn-lg">
          <i class="fas fa-eye"></i>
          ดูห้องทั้งหมด
        </a>
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section class="contact-section">
    <div class="container">
      <div class="section-header">
        <h2>ติดต่อเรา</h2>
        <p>พร้อมให้บริการและตอบคำถามทุกเรื่อง</p>
      </div>
      
      <div class="contact-content">
        <div class="contact-info">
          <div class="contact-card">
            <div class="contact-header">
              <i class="fas fa-info-circle"></i>
              <h3>ข้อมูลติดต่อ</h3>
            </div>
            <div class="contact-body">
              <div class="contact-item">
                <div class="contact-icon">
                  <i class="fas fa-phone"></i>
                </div>
                <div class="contact-details">
                  <strong>โทรศัพท์</strong>
                  <span>02-xxx-xxxx</span>
                  <span>081-xxx-xxxx</span>
                </div>
              </div>
              <div class="contact-item">
                <div class="contact-icon">
                  <i class="fas fa-envelope"></i>
                </div>
                <div class="contact-details">
                  <strong>อีเมล</strong>
                  <span>info@junraikaraoke.com</span>
                </div>
              </div>
              <div class="contact-item">
                <div class="contact-icon">
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="contact-details">
                  <strong>ที่อยู่</strong>
                  <span>123 ถนนสุขุมวิท แขวงคลองเตย</span>
                  <span>เขตคลองเตย กรุงเทพฯ 10110</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="contact-hours">
          <div class="hours-card">
            <div class="contact-header">
              <i class="fas fa-clock"></i>
              <h3>เวลาทำการ</h3>
            </div>
            
            <!-- Current Status -->
            <div class="current-status-mini" id="currentStatusMini">
              <div class="status-indicator-mini">
                <span class="status-dot-mini" id="statusDotMini"></span>
                <span class="status-message-mini" id="statusMessageMini">กำลังตรวจสอบสถานะ...</span>
              </div>
            </div>
            
            <div class="contact-body">
              <div class="hours-list-mini">
                <div class="hours-item main">
                  <div class="hours-day">
                    <i class="fas fa-calendar-check"></i>
                    <span>อังคาร - อาทิตย์</span>
                  </div>
                  <div class="hours-time">
                    <strong>11:00 - 21:00</strong>
                    <small>(10 ชั่วโมง)</small>
                  </div>
                </div>
                <div class="hours-item closed">
                  <div class="hours-day">
                    <i class="fas fa-calendar-times"></i>
                    <span>จันทร์</span>
                  </div>
                  <div class="hours-time">
                    <strong>ปิด</strong>
                    <small>(วันหยุดประจำ)</small>
                  </div>
                </div>
              </div>
              
              <div class="hours-note-mini">
                <i class="fas fa-info-circle"></i>
                <p>เวลาอาจเปลี่ยนแปลงในวันหยุดนักขัตฤกษ์</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="contact-actions">
        <a href="/contact" class="btn btn-primary btn-lg">
          <i class="fas fa-paper-plane"></i>
          ส่งข้อความถึงเรา
        </a>
        <a href="tel:02-xxx-xxxx" class="btn btn-outline btn-lg">
          <i class="fas fa-phone"></i>
          โทรหาเรา
        </a>
      </div>
    </div>
  </section>

  <script>
    // Global variables
    let currentUser = null;
    const API_BASE = '/api';

    // Store Hours Management
    function updateStoreStatus() {
      const now = new Date();
      const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      const currentTime = currentHour + (currentMinute / 60);
      
      const statusElement = document.getElementById('statusText');
      const statusMessageMini = document.getElementById('statusMessageMini');
      const statusDotMini = document.getElementById('statusDotMini');
      const hoursInfo = document.getElementById('storeHoursInfo');
      
      // Store hours: 11:00 - 21:00, Tuesday - Sunday (Closed Monday)
      const openTime = 11; // 11:00
      const closeTime = 21; // 21:00
      const isMonday = currentDay === 1;
      const isOpenDays = currentDay >= 2 || currentDay === 0; // Tuesday-Sunday
      const isWithinHours = currentTime >= openTime && currentTime < closeTime;
      
      if (isMonday) {
        // Monday - Closed
        if (statusElement) {
          statusElement.textContent = '🔴 ปิด (วันหยุด)';
          statusElement.className = 'status-text status-closed';
        }
        if (statusMessageMini) {
          statusMessageMini.textContent = 'ปิดทำการ - วันหยุดประจำ';
          statusMessageMini.className = 'status-message-mini closed';
        }
        if (statusDotMini) {
          statusDotMini.className = 'status-dot-mini closed';
        }
        if (hoursInfo) {
          hoursInfo.classList.add('store-closed');
        }
      } else if (isOpenDays && isWithinHours) {
        // Open
        const hoursLeft = closeTime - currentTime;
        const hoursText = hoursLeft > 1 ? `${Math.floor(hoursLeft)} ชม` : `${Math.floor(hoursLeft * 60)} นาที`;
        
        if (statusElement) {
          statusElement.textContent = `🟢 เปิด (อีก ${hoursText})`;
          statusElement.className = 'status-text status-open';
        }
        if (statusMessageMini) {
          statusMessageMini.textContent = `เปิดให้บริการ - ปิดในอีก ${hoursText}`;
          statusMessageMini.className = 'status-message-mini open';
        }
        if (statusDotMini) {
          statusDotMini.className = 'status-dot-mini open';
        }
        if (hoursInfo) {
          hoursInfo.classList.remove('store-closed');
        }
      } else {
        // Closed
        if (statusElement) {
          statusElement.className = 'status-text status-closed';
        }
        if (statusDotMini) {
          statusDotMini.className = 'status-dot-mini closed';
        }
        if (hoursInfo) {
          hoursInfo.classList.add('store-closed');
        }
        
        // Check if tomorrow is open
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowDay = tomorrow.getDay();
        
        if (tomorrowDay === 1) {
          if (statusElement) {
            statusElement.textContent = '🔴 ปิด (เปิดวันอังคาร 11:00)';
          }
          if (statusMessageMini) {
            statusMessageMini.textContent = 'ปิดทำการ - เปิดวันอังคาร 11:00';
            statusMessageMini.className = 'status-message-mini closed';
          }
        } else if (currentTime < openTime) {
          const hoursUntilOpen = openTime - currentTime;
          const timeText = hoursUntilOpen > 1 ? `${Math.floor(hoursUntilOpen)} ชม` : `${Math.floor(hoursUntilOpen * 60)} นาที`;
          if (statusElement) {
            statusElement.textContent = `🟡 ปิด (เปิดอีก ${timeText})`;
          }
          if (statusMessageMini) {
            statusMessageMini.textContent = `ปิดทำการ - เปิดในอีก ${timeText}`;
            statusMessageMini.className = 'status-message-mini waiting';
          }
        } else {
          if (statusElement) {
            statusElement.textContent = '🔴 ปิด (เปิดพรุ่งนี้ 11:00)';
          }
          if (statusMessageMini) {
            statusMessageMini.textContent = 'ปิดทำการ - เปิดพรุ่งนี้ 11:00';
            statusMessageMini.className = 'status-message-mini closed';
          }
        }
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      loadPopularRooms();
      updateStoreStatus();
      
      // Update store status every minute
      setInterval(updateStoreStatus, 60000);
    });

    // Check authentication
    function checkAuth() {
      const token = localStorage.getItem('token');
      const user = localStorage.getItem('user');
      
      if (token && user) {
        currentUser = JSON.parse(user);
        document.getElementById('authLink').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'block';
        document.getElementById('bookingsLink').style.display = 'block';
        document.getElementById('heroBookingBtn').style.display = 'inline-flex';
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      window.location.reload();
    }

    // Load popular rooms
    async function loadPopularRooms() {
      try {
        const response = await fetch(`${API_BASE}/rooms/roomForm`);
        if (response.ok) {
          const rooms = await response.json();
          const availableRooms = rooms.filter(room => room.status === 'available').slice(0, 3);
          displayPopularRooms(availableRooms);
        } else {
          throw new Error('Failed to load rooms');
        }
      } catch (error) {
        console.error('Error loading rooms:', error);
        document.getElementById('popularRooms').innerHTML = `
          <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            <p>ไม่สามารถโหลดข้อมูลห้องได้</p>
          </div>
        `;
      }
    }

    // Display popular rooms
    function displayPopularRooms(rooms) {
      const container = document.getElementById('popularRooms');
      
      if (rooms.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-door-closed"></i>
            <h3>ไม่มีห้องว่าง</h3>
            <p>ขณะนี้ไม่มีห้องว่างให้บริการ</p>
          </div>
        `;
        return;
      }

      container.innerHTML = rooms.map(room => `
        <div class="room-card featured" onclick="viewRoom(${room.room_id})">
          <div class="room-badge">
            <i class="fas fa-star"></i>
            แนะนำ
          </div>
          
          <div class="room-header">
            <div class="room-status available">
              <i class="fas fa-check-circle"></i>
              ว่าง
            </div>
          </div>
          
          <div class="room-body">
            <h4 class="room-name">
              <i class="fas fa-door-open"></i>
              ${room.name}
            </h4>
            
            <div class="room-info">
              <div class="info-item">
                <i class="fas fa-tags"></i>
                <span>${room.type_name || 'ไม่ระบุประเภท'}</span>
              </div>
              
              <div class="info-item">
                <i class="fas fa-users"></i>
                <span>${room.capacity || 'ไม่ระบุ'} คน</span>
              </div>
            </div>
          </div>
          
          <div class="room-footer">
            <button class="btn btn-primary" onclick="event.stopPropagation(); bookRoom(${room.room_id})">
              <i class="fas fa-calendar-plus"></i>
              จองห้อง
            </button>
          </div>
        </div>
      `).join('');
    }

    // View room details
    function viewRoom(roomId) {
      window.location.href = `/rooms?room=${roomId}`;
    }

    // Book room
    function bookRoom(roomId) {
      if (!currentUser) {
        alert('กรุณาเข้าสู่ระบบก่อนทำการจอง');
        window.location.href = '/auth';
        return;
      }
      
      window.location.href = `/bookings?room=${roomId}`;
    }
  </script>
</body>
</html>
